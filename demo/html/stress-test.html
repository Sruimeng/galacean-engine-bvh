<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BVH Stress Test - Galacean Engine</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
      color: #eee;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1000px;
      margin: 0 auto;
    }

    header {
      text-align: center;
      padding: 30px 0;
    }

    header h1 {
      font-size: 2.2em;
      margin-bottom: 10px;
      color: #ef5350;
    }

    header p {
      color: #aaa;
    }

    .test-panel {
      background: rgba(0, 0, 0, 0.4);
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .test-panel h2 {
      color: #ef5350;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .config-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .config-item label {
      display: block;
      margin-bottom: 5px;
      color: #aaa;
      font-size: 0.9em;
    }

    .config-item select,
    .config-item input {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 6px;
      background: #333;
      color: #fff;
      font-size: 1em;
    }

    .btn {
      padding: 12px 30px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 500;
      transition: all 0.3s;
    }

    .btn-danger {
      background: #ef5350;
      color: white;
    }

    .btn-danger:hover {
      background: #e53935;
    }

    .btn-danger:disabled {
      background: #666;
      cursor: not-allowed;
    }

    .results-container {
      background: rgba(0, 0, 0, 0.4);
      padding: 25px;
      border-radius: 12px;
      margin-bottom: 20px;
    }

    .results-container h2 {
      color: #ef5350;
      margin-bottom: 20px;
    }

    .result-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }

    .result-item {
      background: rgba(255, 255, 255, 0.05);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    .result-item .label {
      color: #aaa;
      font-size: 0.85em;
      margin-bottom: 5px;
    }

    .result-item .value {
      color: #ef5350;
      font-size: 1.5em;
      font-weight: bold;
    }

    .result-item .unit {
      color: #666;
      font-size: 0.8em;
    }

    .progress-section {
      margin-top: 20px;
    }

    .progress-bar {
      height: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 10px;
      overflow: hidden;
      margin-bottom: 10px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #ef5350, #ff8a65);
      transition: width 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8em;
      color: white;
    }

    .progress-text {
      color: #aaa;
      font-size: 0.9em;
    }

    .log-section {
      background: rgba(0, 0, 0, 0.4);
      padding: 25px;
      border-radius: 12px;
    }

    .log-section h2 {
      color: #ef5350;
      margin-bottom: 15px;
    }

    .log-container {
      background: #111;
      border-radius: 8px;
      padding: 15px;
      max-height: 300px;
      overflow-y: auto;
      font-family: 'Monaco', 'Consolas', monospace;
      font-size: 0.85em;
    }

    .log-item {
      padding: 5px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    .log-item.info {
      color: #64b5f6;
    }

    .log-item.success {
      color: #81c784;
    }

    .log-item.warning {
      color: #ffb74d;
    }

    .log-item.error {
      color: #ef5350;
    }

    .log-item .timestamp {
      color: #666;
      margin-right: 10px;
    }

    .memory-warning {
      background: rgba(255, 152, 0, 0.2);
      border: 1px solid #ff9800;
      border-radius: 8px;
      padding: 15px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .memory-warning .icon {
      font-size: 1.5em;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸ‹ï¸ BVH å‹åŠ›æµ‹è¯•</h1>
      <p>æµ‹è¯•å¤§è§„æ¨¡åœºæ™¯ä¸‹çš„ BVH æ€§èƒ½æé™</p>
    </header>

    <div class="memory-warning">
      <span class="icon">âš ï¸</span>
      <div>
        <strong>æ³¨æ„ï¼š</strong>å¤§è§„æ¨¡æµ‹è¯•å¯èƒ½æ¶ˆè€—å¤§é‡å†…å­˜ã€‚å»ºè®®åœ¨æµ‹è¯•å‰å…³é—­å…¶ä»–æ ‡ç­¾é¡µã€‚
        å¦‚æœæµè§ˆå™¨å˜æ…¢ï¼Œè¯·åˆ·æ–°é¡µé¢ã€‚
      </div>
    </div>

    <div class="test-panel">
      <h2>ğŸ”§ æµ‹è¯•é…ç½®</h2>
      <div class="config-grid">
        <div class="config-item">
          <label>å¯¹è±¡æ•°é‡</label>
          <select id="objectCount">
            <option value="10000">10,000</option>
            <option value="50000">50,000</option>
            <option value="100000" selected>100,000</option>
            <option value="200000">200,000</option>
            <option value="500000">500,000</option>
          </select>
        </div>
        <div class="config-item">
          <label>æ„å»ºç­–ç•¥</label>
          <select id="buildStrategy">
            <option value="sah">SAH (æœ€ä¼˜æŸ¥è¯¢)</option>
            <option value="median" selected>Median (å‡è¡¡)</option>
            <option value="equal">Equal (å¿«é€Ÿæ„å»º)</option>
          </select>
        </div>
        <div class="config-item">
          <label>å…‰çº¿æŠ•å°„æ¬¡æ•°</label>
          <select id="raycastCount">
            <option value="1000">1,000</option>
            <option value="5000" selected>5,000</option>
            <option value="10000">10,000</option>
          </select>
        </div>
        <div class="config-item">
          <label>èŒƒå›´æŸ¥è¯¢æ¬¡æ•°</label>
          <select id="rangeQueryCount">
            <option value="500">500</option>
            <option value="1000" selected>1,000</option>
            <option value="2000">2,000</option>
          </select>
        </div>
      </div>
      <button class="btn btn-danger" id="runTest">ğŸš€ å¼€å§‹å‹åŠ›æµ‹è¯•</button>
      
      <div class="progress-section" id="progressSection" style="display: none;">
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill" style="width: 0%">0%</div>
        </div>
        <div class="progress-text" id="progressText">å‡†å¤‡ä¸­...</div>
      </div>
    </div>

    <div class="results-container">
      <h2>ğŸ“Š æµ‹è¯•ç»“æœ</h2>
      <div class="result-grid">
        <div class="result-item">
          <div class="label">å¯¹è±¡ç”Ÿæˆ</div>
          <div class="value" id="genTime">-</div>
          <div class="unit">ms</div>
        </div>
        <div class="result-item">
          <div class="label">BVH æ„å»º</div>
          <div class="value" id="buildTime">-</div>
          <div class="unit">ms</div>
        </div>
        <div class="result-item">
          <div class="label">å…‰çº¿æŠ•å°„</div>
          <div class="value" id="raycastTime">-</div>
          <div class="unit">ms</div>
        </div>
        <div class="result-item">
          <div class="label">èŒƒå›´æŸ¥è¯¢</div>
          <div class="value" id="rangeTime">-</div>
          <div class="unit">ms</div>
        </div>
        <div class="result-item">
          <div class="label">èŠ‚ç‚¹æ•°é‡</div>
          <div class="value" id="nodeCount">-</div>
          <div class="unit">ä¸ª</div>
        </div>
        <div class="result-item">
          <div class="label">æ ‘æ·±åº¦</div>
          <div class="value" id="treeDepth">-</div>
          <div class="unit">å±‚</div>
        </div>
        <div class="result-item">
          <div class="label">å†…å­˜ä¼°ç®—</div>
          <div class="value" id="memoryUsage">-</div>
          <div class="unit">MB</div>
        </div>
        <div class="result-item">
          <div class="label">æŸ¥è¯¢/ç§’</div>
          <div class="value" id="qps">-</div>
          <div class="unit">æ¬¡</div>
        </div>
      </div>
    </div>

    <div class="log-section">
      <h2>ğŸ“ æµ‹è¯•æ—¥å¿—</h2>
      <div class="log-container" id="logContainer">
        <div class="log-item info">
          <span class="timestamp">[--:--:--]</span>
          ç­‰å¾…å¼€å§‹æµ‹è¯•...
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="../src/stress-test.ts"></script>
</body>
</html>